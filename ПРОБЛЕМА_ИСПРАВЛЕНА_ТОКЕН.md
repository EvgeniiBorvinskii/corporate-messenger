# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –° –¢–û–ö–ï–ù–û–ú –ò–°–ü–†–ê–í–õ–ï–ù–ê

## üîç –ß—Ç–æ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ

**–ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –í –∫–ª–∞—Å—Å–µ `ApiService` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞ `_deobfuscate()`!

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ:
1. ‚úÖ –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ —á–µ—Ä–µ–∑ `auth_service.dart`
2. ‚úÖ –¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–ª—Å—è –≤ SharedPreferences
3. ‚ùå **ApiService –ø—ã—Ç–∞–ª—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω, –Ω–æ –Ω–µ –º–æ–≥ –µ–≥–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å!**
4. ‚ùå –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ Authorization header –ù–ï –¥–æ–±–∞–≤–ª—è–ª—Å—è –∫ –∑–∞–ø—Ä–æ—Å–∞–º
5. ‚ùå –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–ª **401 Invalid token** –Ω–∞ –í–°–ï –∑–∞–ø—Ä–æ—Å—ã

### –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö –±—ã–ª–∞:
```
flutter: üì• Response: 401 http://5.249.160.54:3002/api/users
flutter: üì• Response: 401 http://5.249.160.54:3002/api/channels
flutter: ‚ö†Ô∏è Full response: {error: Invalid token}
```

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_deobfuscate()` –≤ ApiService
```dart
static const String _salt = 'LoneStarChatApp2024';

String? _deobfuscate(String value) {
  try {
    final decoded = utf8.decode(base64Decode(value));
    if (decoded.startsWith(_salt) && decoded.endsWith(_salt)) {
      return decoded.substring(_salt.length + 1, decoded.length - _salt.length - 1);
    }
    return null;
  } catch (e) {
    print('‚ö†Ô∏è Token deobfuscation error: $e');
    return null;
  }
}
```

### 2. –£–ª—É—á—à–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ (interceptor) —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
–¢–µ–ø–µ—Ä—å –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
- üîë –ù–∞–ª–∏—á–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ/‚ùå –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
- üì§ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null/error –≤ loadChannels
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –æ—à–∏–±–∫–∏ `type 'Null' is not a subtype of type 'List<dynamic>'`

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ UI-–ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
–ò–∑–º–µ–Ω–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ —Å `_channels.isEmpty && _users.isEmpty` –Ω–∞ `_channels.isEmpty`

### 5. –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏
–ë—ã–ª–∞ —Å—Ç–∞—Ä–∞—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è `_deobfuscate()` —Å –¥—Ä—É–≥–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º - —É–¥–∞–ª–µ–Ω–∞!

## üì± –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ iPhone
```bash
cd "/Users/svetanaborvinskaia/Desktop/Lone Star Chat/mobile"
flutter run -d Curtis
```

**–ò–õ–ò** –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ!

### –®–∞–≥ 2: –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ admin
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: `admin`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ VS Code
–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –æ—à–∏–±–æ–∫ 401 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:

```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ï –õ–û–ì–ò:
flutter: üîë Obfuscated token exists: true
flutter: ‚úÖ Token added to request: temp_token_176034361...
flutter: üì§ Headers: {Authorization: Bearer temp_token_...}
flutter: üì• Response: 200 http://5.249.160.54:3002/api/channels
flutter: üîç DEBUG: Received 7 channels from API
flutter: ‚úÖ Loaded 6 employees
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
1. ‚úÖ –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∫–∞–Ω–∞–ª **"News"**
2. ‚úÖ –í —Ä–∞–∑–¥–µ–ª–µ "–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏" –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. ‚úÖ –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
4. ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå 401 Invalid token –Ω–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚ùå –ü—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- ‚ùå –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–Ω–∞–ª News
- ‚ùå –ù–∏—á–µ–≥–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ 200 OK –Ω–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ 6 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- ‚úÖ –í–∏–¥–µ–Ω –∫–∞–Ω–∞–ª News
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

## üìä –ß—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–í –ª–æ–≥–∞—Ö VS Code Terminal –≤—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
```
flutter: üîê Login response: {token: temp_token_..., user: {...}}
flutter: ‚úÖ Token saved after login
flutter: üîë Obfuscated token exists: true
flutter: ‚úÖ Token added to request: temp_token_176034361...
flutter: üì• Response: 200 http://5.249.160.54:3002/api/channels
flutter: üì• Response: 200 http://5.249.160.54:3002/api/users
flutter: ‚úÖ Loaded 6 employees
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–¢–æ–∫–µ–Ω –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤ SharedPreferences:
- **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è**: `base64(utf8("LoneStarChatApp2024:TOKEN:LoneStarChatApp2024"))`
- **–ö–ª—é—á**: `auth_token_v2`
- **–ó–∞—â–∏—Ç–∞**: –û–±—Ñ—É—Å–∫–∞—Ü–∏—è —Å —Å–æ–ª—å—é

–¢–µ–ø–µ—Ä—å —Ç–æ–∫–µ–Ω **–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API!

## üöÄ –ï—Å–ª–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –ø–æ–ª–Ω–æ—Å—Ç—å—é (–∑–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞)
2. **–í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ** (admin/admin)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ VS Code
4. **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ 401** - –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –Ω–æ–≤—ã–µ –ª–æ–≥–∏

## üìù –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. `mobile/lib/services/api_service.dart` - **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**
2. `mobile/lib/screens/home/tabs/chats_tab_screen.dart` - –∑–∞—â–∏—Ç–∞ –æ—Ç null
3. `mobile/lib/screens/home/tabs/employees_screen.dart` - —É–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≥–∏
4. `mobile/lib/models/channel.dart` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è! üéâ
