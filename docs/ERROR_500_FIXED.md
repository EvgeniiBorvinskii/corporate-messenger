# ‚úÖ –û–®–ò–ë–ö–ê 500 –ò–°–ü–†–ê–í–õ–ï–ù–ê!

## üî¥ –ü–†–û–ë–õ–ï–ú–ê:

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞ —Å iPhone –ø—Ä–∏—Ö–æ–¥–∏–ª–∞ –æ—à–∏–±–∫–∞ 500:
```
Error: Only images are allowed (jpeg, jpg, png, gif, webp)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –≤ `multer`.
- –ü—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ò MIME-type –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- iPhone –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã —Å –¥—Ä—É–≥–∏–º–∏ MIME-—Ç–∏–ø–∞–º–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏–ª–æ –ø–æ–¥ –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

–ò–∑–º–µ–Ω–∏–ª `fileFilter` –Ω–∞ –±–æ–ª–µ–µ –º—è–≥–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

```javascript
// –ë–´–õ–û (—Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ):
fileFilter: (req, file, cb) => {
  const allowedTypes = /jpeg|jpg|png|gif|webp/;
  const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
  const mimetype = allowedTypes.test(file.mimetype);
  
  if (extname && mimetype) {  // ‚ùå –û–±–∞ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞—Å—Ç—å
    cb(null, true);
  } else {
    cb(new Error('Only images are allowed'));
  }
}

// –°–¢–ê–õ–û (–ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ):
fileFilter: (req, file, cb) => {
  console.log('üì∏ Avatar upload - file info:', {
    originalname: file.originalname,
    mimetype: file.mimetype
  });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ MIME-type
  if (file.mimetype.startsWith('image/')) {  // ‚úÖ –õ—é–±—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    cb(null, true);
  } else {
    cb(new Error('Only images are allowed'));
  }
}
```

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è:**
- `image/jpeg`
- `image/jpg`
- `image/png`
- `image/gif`
- `image/webp`
- `image/heic` (—Ñ–æ—Ä–º–∞—Ç iPhone)
- –õ—é–±–æ–π –¥—Ä—É–≥–æ–π image/* —Ç–∏–ø

---

## üöÄ –ß–¢–û –°–î–ï–õ–ê–ù–û:

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω fileFilter –≤ backend/server-chat.js
2. ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä 5.249.160.54
3. ‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (–ø—Ä–æ—Ü–µ—Å—Å 919630)
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: News –∫–∞–Ω–∞–ª –µ—Å—Ç—å –≤ API (6 –∫–∞–Ω–∞–ª–æ–≤)

---

## üì± –ü–û–ü–†–û–ë–£–ô –ó–ê–ì–†–£–ó–ò–¢–¨ –ê–í–ê–¢–ê–† –°–ï–ô–ß–ê–°:

1. **–ù–ï –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (–æ—à–∏–±–∫–∞ –±—ã–ª–∞ –Ω–∞ backend)
2. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü—Ä–æ—Ñ–∏–ª—å
4. –ù–∞–∂–º–∏ –Ω–∞ –∞–≤–∞—Ç–∞—Ä
5. –í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ
6. **–î–æ–ª–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è!** ‚úÖ

---

## üîç –ß–¢–û –°–ú–û–¢–†–ï–¢–¨ –í –õ–û–ì–ê–•:

### –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:
```
flutter: üì§ Request: POST /api/users/1/avatar
flutter: üì• Response: 200
flutter: –ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!
```

### –ï—Å–ª–∏ –æ–ø—è—Ç—å –æ—à–∏–±–∫–∞:
–°–º–æ—Ç—Ä–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ Flutter:
```
flutter: Error uploading avatar: ...
```

–ò –ø—Ä–∏—à–ª–∏ –º–Ω–µ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏!

---

## üéØ –ò–¢–û–ì:

‚úÖ Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω - fileFilter —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ image/* —Ñ–∞–π–ª—ã
‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
‚úÖ News –∫–∞–Ω–∞–ª –µ—Å—Ç—å –≤ API
‚úÖ –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä

**–ü–æ–ø—Ä–æ–±—É–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ —Å–∫–∞–∂–∏:**
- "–ó–∞–≥—Ä—É–∑–∏–ª–æ—Å—å!" ‚úÖ
- "–û–ø—è—Ç—å –æ—à–∏–±–∫–∞: ..." ‚ùå
